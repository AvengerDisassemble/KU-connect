// ===============================
//  Prisma Schema for KU Connect
//  (Job Posting Feature Updated)
// ===============================

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

// Use SQLite for test/dev
datasource test_db {
  provider = "sqlite"
  url      = env("TEST_DATABASE_URL")
}

// Uncomment for production PostgreSQL
// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// ------------------------------
//  ENUMS
// ------------------------------

enum Industry {
  IT_HARDWARE_AND_DEVICES
  IT_SOFTWARE
  IT_SERVICES
  NETWORK_SERVICES
  EMERGING_TECH
  E_COMMERCE
  OTHER
}

enum CompanySize {
  ONE_TO_TEN
  ELEVEN_TO_FIFTY
  FIFTY_ONE_TO_TWO_HUNDRED
  TWO_HUNDRED_PLUS
}

enum ApplicationStatus {
  PENDING
  QUALIFIED
  REJECTED
}

// ------------------------------
//  MODELS
// ------------------------------

model User {
  id          Int         @id @default(autoincrement())
  name        String
  surname     String
  username    String      @unique
  password    String
  email       String      @unique
  phoneNumber String?     @unique
  verified    Boolean     @default(false)
  professor   Professor?
  admin       Admin?
  student     Student?
  hr          HR?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  reports     JobReport[]
}

model Professor {
  id         Int    @id @default(autoincrement())
  userId     Int    @unique
  department String
  user       User   @relation(fields: [userId], references: [id])
}

model Admin {
  id     Int  @id @default(autoincrement())
  userId Int  @unique
  user   User @relation(fields: [userId], references: [id])
}

model Student {
  id                     Int               @id @default(autoincrement())
  userId                 Int               @unique
  degreeType             DegreeType        @relation(fields: [degreeTypeId], references: [id])
  degreeTypeId           Int
  address                String
  gpa                    Float?
  expectedGraduationYear Int?
  user                   User              @relation(fields: [userId], references: [id])
  interests              StudentInterest[]
  resumes                Resume[]
  applications           Application[]
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
}

model HR {
  id          Int         @id @default(autoincrement())
  userId      Int         @unique
  companyName String
  description String
  address     String
  industry    Industry    @default(OTHER)
  companySize CompanySize @default(ONE_TO_TEN)
  website     String?
  user        User        @relation(fields: [userId], references: [id])
  jobs        Job[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model DegreeType {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  students Student[]
}

// ------------------------------
//  JOB FEATURE MODELS
// ------------------------------

model Job {
  id                        Int               @id @default(autoincrement())
  hrId                      Int
  hr                        HR                @relation(fields: [hrId], references: [id])
  title                     String
  companyName               String
  description               String
  location                  String
  jobType                   String // internship, part-time, full-time, contract
  workArrangement           String // on-site, remote, hybrid
  duration                  String // e.g. 6-month, 1-year
  minSalary                 Int
  maxSalary                 Int
  application_deadline      DateTime
  email                     String?
  phone_number              String
  other_contact_information String?
  interests                 StudentInterest[]
  requirements              Requirement[]
  qualifications            Qualification[]
  responsibilities          Responsibility[]
  benefits                  Benefit[]
  tags                      Tag[]             @relation("JobTags")
  applications              Application[]
  reports                   JobReport[]
  createdAt                 DateTime          @default(now())
  updatedAt                 DateTime          @updatedAt
}

model Tag {
  id   Int    @id @default(autoincrement())
  name String @unique
  jobs Job[]  @relation("JobTags")
}

model Requirement {
  id    Int    @id @default(autoincrement())
  jobId Int
  text  String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model Qualification {
  id    Int    @id @default(autoincrement())
  jobId Int
  text  String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model Responsibility {
  id    Int    @id @default(autoincrement())
  jobId Int
  text  String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model Benefit {
  id    Int    @id @default(autoincrement())
  jobId Int
  text  String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

// ------------------------------
//  APPLICATION & SUPPORT MODELS
// ------------------------------

model Application {
  id        Int               @id @default(autoincrement())
  jobId     Int
  studentId Int
  resumeId  Int?
  status    ApplicationStatus @default(PENDING)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  job     Job     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  resume  Resume? @relation(fields: [resumeId], references: [id])

  @@unique([jobId, studentId])
}

model JobReport {
  id        Int      @id @default(autoincrement())
  jobId     Int
  userId    Int
  reason    String
  createdAt DateTime @default(now())

  job  Job  @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StudentInterest {
  id        Int     @id @default(autoincrement())
  studentId Int
  jobId     Int
  student   Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  job       Job     @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model Resume {
  id           Int           @id @default(autoincrement())
  studentId    Int
  link         String
  student      Student       @relation(fields: [studentId], references: [id], onDelete: Cascade)
  applications Application[]
}
